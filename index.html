<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Traduzir via translate.google.com (sem limite de URL)</title>
  <style>
    :root { --bg:#0b1020; --panel:#101735; --ink:#e9ecf8; --muted:#9aa3c7; --primary:#7c9cff; --warn:#ffd166; --danger:#ff6b6b; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial}
    .wrap{max-width:980px;margin:40px auto;padding:24px}
    .card{background:var(--panel);border:1px solid #1a224a;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    header{padding:20px 24px;border-bottom:1px solid #1a224a}
    header h1{margin:0;font-size:22px;font-weight:700}
    header p{margin:6px 0 0;color:var(--muted);font-size:14px}
    .content{display:grid;grid-template-columns:1fr;gap:16px;padding:20px 24px}
    @media (min-width:900px){.content{grid-template-columns:1fr 360px}}
    textarea{width:100%;min-height:260px;border:1px solid #263068;background:#0f1430;color:var(--ink);border-radius:12px;padding:12px 14px;resize:vertical;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    .panel{display:grid;gap:12px}.warn{color:var(--warn)}.danger{color:var(--danger)}.small{font-size:12px;color:var(--muted)}.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    label{font-size:13px;color:var(--muted)}
    input[type=text]{width:100%;border:1px solid #263068;background:#0f1430;color:var(--ink);border-radius:10px;padding:10px 12px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    button{appearance:none;border:1px solid #2b3aa3;background:linear-gradient(180deg,#4a63ff,#3b53f0);color:white;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    button.secondary{background:#0f1430;border-color:#2a366f;color:#cdd6ff}
    button:disabled{opacity:.55;cursor:default}
    .muted{color:var(--muted);font-size:13px}
    .out{white-space:pre-wrap;background:#0f1430;border:1px dashed #2b366d;border-radius:12px;padding:14px}
    .tip{font-size:13px;color:#b6c1ff;background:#0f1430;border:1px solid #23306e;border-radius:10px;padding:10px}
  </style>
  <script>
    // Util: ler e escrever a query string
    const qs = new URLSearchParams(location.search);
    function getParam(name, def="") { return qs.get(name) ?? def; }
    function setParam(name, val) { if (val==null || val==="") qs.delete(name); else qs.set(name, val); }

    // Tamanho aproximado da URL final (para evitar 413/414)
    function urlSizeFor(text){
      // base: esta página + parâmetros SL/TL/HL + 'u='
      const base = location.href.split('?')[0];
      const encoded = encodeURIComponent(text||'');
      return (base.length + 200) + encoded.length; // chute conservador
    }

    function currentText(){
      const raw = getParam('t', '');
      try { return decodeURIComponent(raw); } catch { return raw; }
    }

    function updatePreviewFromQuery(){
      const t = currentText();
      document.getElementById('text').value = t;
      document.getElementById('preview').textContent = t || '— sem conteúdo —';
      const disabled = !t;
      document.getElementById('openTranslated').disabled = disabled;
      document.getElementById('copyTranslated').disabled = disabled;
      // aviso de tamanho
      const size = urlSizeFor(t);
      const limit = 1800; // seguro
      const hint = document.getElementById('sizeHint');
      if (t && size > limit){
        hint.innerHTML = `⚠️ Seu texto vai gerar uma URL grande (~${size} chars). Use <b>Baixar HTML com o texto</b> abaixo.`;
        hint.className = 'warn';
      } else {
        hint.textContent = '';
      }
    }

    function pushTextToUrl(){
      const t = document.getElementById('text').value || '';
      setParam('t', encodeURIComponent(t));
      const sl = document.getElementById('sl').value.trim() || 'auto';
      const tl = document.getElementById('tl').value.trim() || 'pt';
      const hl = document.getElementById('hl').value.trim() || 'pt-BR';
      setParam('_x_tr_sl', sl); setParam('_x_tr_tl', tl); setParam('_x_tr_hl', hl);
      const url = location.pathname + '?' + qs.toString();
      history.replaceState(null, '', url);
      updatePreviewFromQuery();
    }

    function buildLegacyUrl(){
      const here = new URL(location.href);
      const sl = document.getElementById('sl').value.trim() || getParam('_x_tr_sl', 'auto');
      const tl = document.getElementById('tl').value.trim() || getParam('_x_tr_tl', 'pt');
      const hl = document.getElementById('hl').value.trim() || getParam('_x_tr_hl', 'pt-BR');
      const legacy = new URL('https://translate.google.com/translate');
      legacy.searchParams.set('sl', sl);
      legacy.searchParams.set('tl', tl);
      legacy.searchParams.set('hl', hl);
      legacy.searchParams.set('u', here.toString());
      return legacy.toString();
    }

    function buildLegacyUrlFor(href){
      const sl = document.getElementById('sl').value.trim() || 'auto';
      const tl = document.getElementById('tl').value.trim() || 'pt';
      const hl = document.getElementById('hl').value.trim() || 'pt-BR';
      const legacy = new URL('https://translate.google.com/translate');
      legacy.searchParams.set('sl', sl);
      legacy.searchParams.set('tl', tl);
      legacy.searchParams.set('hl', hl);
      legacy.searchParams.set('u', href);
      return legacy.toString();
    }

    function openTranslated(){
      const t = document.getElementById('text').value || '';
      if (urlSizeFor(t) > 1800){
        toast('Texto grande: baixe o HTML e hospede, depois use a URL hospedada.');
        document.getElementById('exportBox').style.outline = '1px solid #ffb703';
        return;
      }
      pushTextToUrl();
      const url = buildLegacyUrl();
      window.open(url, '_blank', 'noopener');
    }

    async function copyTranslated(){
      pushTextToUrl();
      const url = buildLegacyUrl();
      try { await navigator.clipboard.writeText(url); toast('Link traduzido copiado!'); }
      catch { alert(url); }
    }

    // Gera um arquivo HTML com o texto embutido (sem usar query string)
    function exportHtml(){
      const text = document.getElementById('text').value || '';
      if (!text){ toast('Cole um texto primeiro.'); return; }
      const safe = text.replace(/<\/script>/gi, '<\/script>');
      const html = `<!doctype html>
<html lang=\"pt-BR\">
<meta charset=\"utf-8\">
<title>Conteúdo para traduzir</title>
<style>body{font:16px system-ui;max-width:850px;margin:40px auto;padding:0 16px;line-height:1.5}pre{white-space:pre-wrap}</style>
<main>
<h1>Conteúdo</h1>
<pre>${safe}</pre>
</main>
</html>`;
      const blob = new Blob([html], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'meu-texto.html'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 2000);
      toast('Arquivo baixado: publique e cole a URL abaixo.');
    }

    function openHosted(){
      const hosted = document.getElementById('hostedUrl').value.trim();
      if (!hosted){ toast('Cole a URL hospedada primeiro.'); return; }
      const url = buildLegacyUrlFor(hosted);
      window.open(url, '_blank', 'noopener');
    }

    function toast(msg){
      const el = document.createElement('div');
      el.textContent = msg; el.style.cssText = 'position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#0f1430;border:1px solid #2b3aa3;color:#cdd6ff;padding:10px 14px;border-radius:12px;z-index:9999';
      document.body.appendChild(el); setTimeout(()=>el.remove(), 1800);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('sl').value = getParam('_x_tr_sl','auto');
      document.getElementById('tl').value = getParam('_x_tr_tl','pt');
      document.getElementById('hl').value = getParam('_x_tr_hl','pt-BR');
      updatePreviewFromQuery();
    });
  ('DOMContentLoaded', ()=>{
      // Preenche sl/tl/hl a partir da URL, se houver
      document.getElementById('sl').value = getParam('_x_tr_sl','auto');
      document.getElementById('tl').value = getParam('_x_tr_tl','pt');
      document.getElementById('hl').value = getParam('_x_tr_hl','pt-BR');
      updatePreviewFromQuery();
    });
  </script>
</head>
<body>
  <div class="wrap card">
    <header>
      <h1>Traduzir minha própria página via <code>translate.google.com</code></h1>
      <p>Para textos curtos, dá pra embutir na URL e abrir direto. Para textos longos, <b>baixe um HTML com o texto</b>, hospede (GitHub Pages / Netlify) e cole a URL hospedada.</p>
    </header>
    <div class="content">
      <section>
        <label for="text">Seu texto</label>
        <textarea id="text" placeholder="Cole aqui seu texto..."></textarea>
        <div id="sizeHint" class="small"></div>
        <div class="row">
          <button class="secondary" onclick="pushTextToUrl()">Atualizar URL (salvar conteúdo)</button>
          <button id="openTranslated" onclick="openTranslated()">Abrir traduzido (translate.google.com)</button>
        </div>
        <p class="muted">Dica: depois de salvar na URL, você pode compartilhar o link. Para textos grandes, use a caixa ao lado.</p>
        <div class="tip">Se aparecer erro <b>413 / 414</b>, é porque a URL ficou grande demais. Gere um HTML com o texto e hospede.</div>
      </section>
      <aside class="panel" id="exportBox">
        <div>
          <label>Idioma de origem (sl)</label>
          <input id="sl" type="text" placeholder="auto" value="auto" />
        </div>
        <div class="row">
          <div>
            <label>Destino (tl)</label>
            <input id="tl" type="text" placeholder="pt" value="pt" />
          </div>
          <div>
            <label>Idioma da UI (hl)</label>
            <input id="hl" type="text" placeholder="pt-BR" value="pt-BR" />
          </div>
        </div>
        <hr style="border:0;border-top:1px solid #1a224a">
        <div>
          <label>Texto grande?</label>
          <div class="small">1) Clique em <b>Baixar HTML com o texto</b> • 2) Hospede o arquivo (GitHub Pages/Netlify Drop) • 3) Cole a URL abaixo e abra traduzido.</div>
        </div>
        <div class="row">
          <button class="secondary" onclick="exportHtml()">Baixar HTML com o texto</button>
          <span class="muted">Gera <code>meu-texto.html</code></span>
        </div>
        <input id="hostedUrl" type="text" placeholder="https://seu-site.exemplo/meu-texto.html" />
        <div class="row">
          <button class="secondary" onclick="openHosted()">Abrir traduzido (URL hospedada)</button>
          <button class="secondary" id="copyTranslated" onclick="copyTranslated()">Copiar link traduzido (modo curto)</button>
        </div>
        <div>
          <label>Pré-visualização (não traduzida)</label>
          <div id="preview" class="out">— sem conteúdo —</div>
        </div>
      </aside>
    </div>
  </div>
</body>
</html>
